(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b8afbf4"],{"11a9":function(e,t,n){},8063:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"cs-p"},[n("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",[n("el-button-group",[n("el-button",{attrs:{icon:"el-icon-circle-plus-outline",disabled:e.loading},on:{click:function(t){return e.checkedNodes(!0)}}},[e._v("展开")]),n("el-button",{attrs:{icon:"el-icon-remove-outline",disabled:e.loading},on:{click:function(t){return e.checkedNodes(!1)}}},[e._v("收起")])],1)],1),n("el-form-item",{attrs:{label:"过滤"}},[n("el-input",{staticStyle:{width:"240px"},attrs:{disabled:e.loading,placeholder:"输入关键词进行过滤","prefix-icon":"el-icon-search",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),n("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:e.$route.path}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:10}},[e.hackReset?n("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"menu_id",data:e.treeData,props:e.treeProps,"filter-node-method":e.filterNode,"highlight-current":!0,"default-expand-all":e.isExpandAll,"default-expanded-keys":e.expanded,"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,draggable:!0,"show-checkbox":!0},on:{"node-click":e.handleNodeClick,"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{staticClass:"custom-tree-node action"},[n("span",{staticClass:"brother-showing",class:{"status-tree":!r.status}},[!r.system&&e.auth.move?n("i",{staticClass:"el-icon-sort move-tree cs-mr-5"}):e._e(),r.icon?n("i",{class:"iconfont icon"+r.icon}):n("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(a.label)+" ")])])}}],null,!1,403616506)}):e._e()],1),n("el-col",{attrs:{span:14}},[n("el-card",{directives:[{name:"show",rawName:"v-show",value:e.auth.add||e.auth.set,expression:"auth.add || auth.set"}],staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(e.formMap[e.formStatus]))]),"create"===e.formStatus&&e.auth.add?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:e.formLoading},on:{click:e.create}},[e._v("确定")]):"update"===e.formStatus&&e.auth.set?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:e.formLoading},on:{click:e.update}},[e._v("修改")]):e._e()],1),n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"选择角色",prop:"group_id"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"update"===e.formStatus,placeholder:"请选择"},on:{change:e.onselectChange},model:{value:e.form.group_id,callback:function(t){e.$set(e.form,"group_id",t)},expression:"form.group_id"}},e._l(e.group,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1)],1)],1)],1)],1)],1)},r=[],o=(n("99af"),n("4de4"),n("4160"),n("caad"),n("c975"),n("b0c0"),n("d3b7"),n("2532"),n("159b"),n("2909")),i=n("ca7e"),s=n("ca00"),l=n("a308"),u={props:{loading:{default:!1},treeData:{default:function(){return[]}},module:{default:function(){}},group:{default:function(){}},whitelist:{default:function(){return[]}}},data:function(){return{hackReset:!0,isExpandAll:!0,expanded:[],filterText:"",treeLoading:!1,treeProps:{label:"name",children:"children"},auth:{add:!0,del:!0,set:!0,enable:!0,disable:!0,move:!0},form:{module:void 0,group_id:void 0,name:void 0,menu_auth:[],log_auth:[],sort:50,status:"1"},menuData:[],formStatus:"create",formLoading:!1,formMap:{create:"权限配置",update:"编辑权限"},menuAuth:[],logAuth:[],rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:32,message:"长度不能大于 32 个字符",trigger:"blur"}],module:[{required:!0,message:"至少选择一项",trigger:"change"}],group_id:[{required:!0,message:"至少选择一项",trigger:"change"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{filterText:function(e){this.$refs.tree.filter(e)},"form.module":{handler:function(e){this.switchModule(e)},deep:!0}},mounted:function(){},methods:{_validationAuth:function(){this.auth.add=this.$permission("/setting/auth/rule/add"),this.auth.del=this.$permission("/setting/auth/rule/del"),this.auth.set=this.$permission("/setting/auth/rule/set"),this.auth.enable=this.$permission("/setting/auth/rule/enable"),this.auth.disable=this.$permission("/setting/auth/rule/disable"),this.auth.move=this.$permission("/setting/auth/rule/move")},getModuleName:function(e){return Object.prototype.hasOwnProperty.call(this.module,e)?this.module[e]:""},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},checkedNodes:function(e){var t=this;this.filterText="",this.expanded=[],this.hackReset=!1,this.$nextTick((function(){t.isExpandAll=e,t.hackReset=!0}))},remove:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var a=e.filter((function(e){return!Object.prototype.hasOwnProperty.call(t.module,e)}));Object(i["b"])(a).then((function(){a.forEach((function(e){t.$refs.tree.remove(e)})),n&&t.$refs.tree.setCheckedKeys([]),t.handleCreate("create"),t.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},removeList:function(){this.remove(this.$refs.tree.getCheckedKeys(!0))},enable:function(e,t){var n=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var r=e.filter((function(e){return!Object.prototype.hasOwnProperty.call(n.module,e)}));Object(i["f"])(r,t).then((function(){r.forEach((function(e){n.$refs.tree.getNode(e).data.status=t})),a&&n.$refs.tree.setCheckedKeys([]),n.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},setStatusList:function(e){this.enable(this.$refs.tree.getCheckedKeys(!0),e)},setStatusItem:function(e,t){this.enable([e],t?0:1,!1)},onselectChange:function(e){var t=this;Object(i["c"])({group_id:e}).then((function(e){var n=s["a"].getColumn(e.data||[],"menu_id");t.$refs.tree.setCheckedKeys(n)}))},handleNodeClick:function(e){var t=[].concat(Object(o["a"])(this.$refs.tree.getCheckedKeys()),Object(o["a"])(this.$refs.tree.getHalfCheckedKeys()));console.log(t)},allowDrag:function(e){return!Object.prototype.hasOwnProperty.call(this.module,e.key)&&this.auth.move},allowDrop:function(e,t,n){return!(e.parent!==t.parent||"inner"===n)},handleDrop:function(e,t){},switchModule:function(e){var t=this;e?(this.treeLoading=!0,Object(l["e"])({module:e}).then((function(n){if(t.menuData=s["a"].formatDataToTree(n.data),"update"===t.formStatus&&n.data){if(!t.menuAuth.length&&!t.logAuth.length)return;var a=[];if(n.data.forEach((function(e){e.children_total<=0&&a.push(e.menu_id)})),!a.length)return;t.form.menu_auth=t.menuAuth.filter((function(e){return a.includes(e)})),"api"===e&&(t.form.log_auth=t.logAuth.filter((function(e){return a.includes(e)})))}})).finally((function(){t.treeLoading=!1}))):this.menuData=[]},resetForm:function(){this.form={module:"",group_id:"",name:"",menu_auth:[],log_auth:[],sort:50,status:"1"}},resetElements:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"create";this.$nextTick((function(){e.$refs.form.clearValidate()})),this.menuData=[],this.menuAuth=[],this.logAuth=[],this.formStatus=t,this.formLoading=!1},handleCreate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetForm(),this.resetElements(e),t&&(this.form.module=t)},_getCheckedKeys:function(){this.form.menu_auth=[].concat(Object(o["a"])(this.$refs.tree.getCheckedKeys()),Object(o["a"])(this.$refs.tree.getHalfCheckedKeys()))},create:function(){var e=this;this.$refs.form.validate((function(t){t&&(e._getCheckedKeys(),e.formLoading=!0,e.form.menu_auth.length>0&&Object(i["a"])({group_id:e.form.group_id,menu_auth:e.form.menu_auth}).then((function(){e.$message.success("操作成功"),e.resetForm(),e.$refs.tree.setCheckedKeys([]),e.$emit("refresh")})).catch((function(){e.formLoading=!1})))}))},update:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.formLoading=!0,e._getCheckedKeys(),Object(i["e"])(e.form).then((function(){e.$emit("refresh"),e.$message.success("操作成功")})).catch((function(){e.formLoading=!1})))}))},checkLogAuth:function(e){return e.childNodes.length>0||this.form.menu_auth.includes(e.key)},checkWhitelist:function(e){return 4!==this.form.group_id&&("api"===e.module&&!e.children&&this.whitelist.includes(e.menu_id))}}},c=u,d=(n("e71e"),n("2877")),h=Object(d["a"])(c,a,r,!1,null,"6c34b7db",null);t["default"]=h.exports},e71e:function(e,t,n){"use strict";n("11a9")}}]);